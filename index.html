<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Cadastro - Produtos e Receitas</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/calendario.css">
    <style>
        /* Estilos para badges */
        .badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        .badge-success {
            background: #28a745;
            color: white;
        }
        .badge-warning {
            background: #ffc107;
            color: #212529;
        }
        
        /* Estilos para toast */
        .toast-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            padding: 12px 16px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            font-size: 14px;
            max-width: 400px;
            font-family: inherit;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Sistema de Cadastro - Produtos e Receitas</h1>
            <div>
                <button class="btn btn-secondary" onclick="mostrarUUID()">üîç Mostrar UUID</button>
                <button class="btn btn-secondary" onclick="logout()">Sair</button>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('produtos-novo')">üõí Produtos</button>
<button class="tab" onclick="irParaReceitas()">üìã Cadastro de Receitas</button>
            <button class="tab" onclick="showTab('tipos-refeicoes')">Tipos de Refei√ß√µes</button>
            <button class="tab" onclick="showTab('clientes')">Cadastro de Clientes</button>
            <button class="tab" onclick="showTab('cardapio')">Planejamento de Card√°pio</button>
        </div>

        <div class="content">
            <!-- ABA: Produtos -->
            <div id="produtos-novo" class="tab-content">
                <div class="section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2>üõí Gest√£o de Produtos</h2>
                        <div>
                            <button class="btn btn-primary" onclick="abrirModalNovoProduto()">+ Novo Produto</button>
                            <button class="btn btn-secondary" onclick="recarregarProdutos()">üìã Listar Produtos</button>
                        </div>
                    </div>

                    <div style="display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap;">
                        <input type="text" id="busca-produtos" placeholder="üîç Buscar produtos..." style="min-width: 200px; padding: 8px 12px; border: 1px solid #ced4da; border-radius: 4px;">
                        <select id="filtro-grupo" style="padding: 8px 12px; border: 1px solid #ced4da; border-radius: 4px;">
                            <option value="">Todos os grupos</option>
                            <option value="Ingredientes">Ingredientes</option>
                            <option value="Descart√°veis">Descart√°veis</option>
                            <option value="Outros produtos">Outros produtos</option>
                        </select>
                        <span>Total: <strong id="total-produtos">0</strong> produtos</span>
                    </div>

                    <div class="table-responsive">
                        <table id="tabelaProdutosNovo">
                            <thead>
                                <tr>
                                    <th>C√≥digo</th>
                                    <th>Descri√ß√£o</th>
                                    <th>Grupo</th>
                                    <th>Unidade</th>
                                    <th>Peso Bruto</th>
                                    <th>Peso L√≠quido</th>
                                    <th>Pre√ßo</th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="produtos-tbody">
                                <tr>
                                    <td colspan="8" style="text-align: center; padding: 40px; color: #666;">
                                        Carregando produtos...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div style="margin-top: 20px; padding: 15px; background: #e7f3ff; border-radius: 5px; border-left: 4px solid #2196f3;">
                        <h3>üîß Status do Sistema</h3>
                        <p><strong>Supabase:</strong> <span id="status-supabase" style="display: inline-block; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: 600; background: #f8d7da; color: #721c24;">Verificando...</span></p>
                        <p><strong>Usu√°rio:</strong> <span id="usuario-info">Carregando...</span></p>
                        <p><strong>√öltimo erro:</strong> <span id="ultimo-erro">Nenhum</span></p>
                    </div>
                </div>
            </div>

            <!-- Cadastro de Receitas -->
           

            <!-- Tipos de Refei√ß√µes -->
            <div id="tipos-refeicoes" class="tab-content hidden">
                <div class="section">
                    <h2>üçΩÔ∏è Gest√£o de Tipos de Refei√ß√µes</h2>
                    <p>Sistema de tipos de refei√ß√µes ser√° carregado aqui.</p>
                </div>
            </div>

            <!-- CLIENTES -->
            <div id="clientes" class="tab-content hidden">
                <div class="section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2>üë• Gest√£o de Clientes</h2>
                        <div>
                            <button class="btn btn-primary" onclick="abrirModalNovoCliente()">+ Novo Cliente</button>
                            <button class="btn btn-secondary" onclick="recarregarClientes()">üìã Listar Clientes</button>
                        </div>
                    </div>

                    <div style="display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap;">
                        <input type="text" id="busca-clientes" placeholder="üîç Buscar clientes..." style="min-width: 200px; padding: 8px 12px; border: 1px solid #ced4da; border-radius: 4px;">
                        <span>Total: <strong id="total-clientes">0</strong> clientes</span>
                    </div>

                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>C√≥digo</th>
                                    <th>Descri√ß√£o</th>
                                    <th>Endere√ßo</th>
                                    <th>Telefone</th>
                                    <th>E-mail</th>
                                    <th>Tipos Vinculados</th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="clientes-tbody">
                                <tr>
                                    <td colspan="7" style="text-align: center; padding: 40px; color: #666;">
                                        üìã Clique em "Listar Clientes" para carregar os dados
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- PLANEJAMENTO DE CARD√ÅPIO -->
            <div id="cardapio" class="tab-content hidden">
                <div class="section">
                    <h2>üìÖ Planejamento de Card√°pio</h2>
                    <p>Sistema de card√°pio ser√° carregado aqui.</p>
                </div>
            </div>
        </div>

        <!-- ===== MODAIS ===== -->

        <!-- Modal de Produto -->
        <div id="modal-produto" class="modal">
            <div class="modal-content">
                <span class="close" onclick="fecharModalProduto()">&times;</span>
                <h2>üì¶ Produto</h2>
                <form>
                    <input type="hidden" id="produto-id">
                    
                    <div class="form-group">
                        <label for="produto-codigo">C√≥digo:</label>
                        <input type="text" id="produto-codigo" readonly style="background-color: #f8f9fa;">
                    </div>
                    
                    <div class="form-group">
                        <label for="produto-descricao">Descri√ß√£o: *</label>
                        <input type="text" id="produto-descricao" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="produto-grupo">Grupo:</label>
                        <select id="produto-grupo">
                            <option value="Ingredientes">Ingredientes</option>
                            <option value="Descart√°veis">Descart√°veis</option>
                            <option value="Outros produtos">Outros produtos</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="produto-unidade">Unidade de Medida:</label>
                        <select id="produto-unidade">
                            <option value="KG">KG</option>
                            <option value="L">L</option>
                            <option value="UN">UN</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="produto-peso-bruto">Peso Bruto:</label>
                        <input type="number" id="produto-peso-bruto" step="0.01" min="0">
                    </div>
                    
                    <div class="form-group">
                        <label for="produto-peso-liquido">Peso L√≠quido:</label>
                        <input type="number" id="produto-peso-liquido" step="0.01" min="0">
                    </div>
                    
                    <div class="form-group">
                        <label for="produto-preco">Pre√ßo:</label>
                        <input type="number" id="produto-preco" step="0.01" min="0">
                    </div>
                </form>
                <div class="actions">
                    <button class="btn btn-secondary" onclick="fecharModalProduto()">Cancelar</button>
                    <button class="btn btn-primary" onclick="salvarProduto()">Salvar</button>
                </div>
            </div>
        </div>

        <!-- Modal de Cliente -->
        <div id="modal-cliente" class="modal">
            <div class="modal-content" style="max-width: 600px;">
                <span class="close" onclick="fecharModalCliente()">&times;</span>
                <h2>üë§ Cliente</h2>
                <form>
                    <input type="hidden" id="cliente-id">
                    
                    <div class="form-group">
                        <label for="cliente-codigo">C√≥digo:</label>
                        <input type="text" id="cliente-codigo" readonly style="background-color: #f8f9fa;">
                    </div>
                    
                    <div class="form-group">
                        <label for="cliente-descricao">Nome/Raz√£o Social: *</label>
                        <input type="text" id="cliente-descricao" required maxlength="50">
                    </div>
                    
                    <div class="form-group">
                        <label for="cliente-endereco">Endere√ßo:</label>
                        <input type="text" id="cliente-endereco" maxlength="50">
                    </div>
                    
                    <div class="form-group">
                        <label for="cliente-numero">N√∫mero:</label>
                        <input type="text" id="cliente-numero" maxlength="4">
                    </div>
                    
                    <div class="form-group">
                        <label for="cliente-telefone">Telefone:</label>
                        <input type="tel" id="cliente-telefone" placeholder="(00)00000-0000">
                    </div>
                    
                    <div class="form-group">
                        <label for="cliente-email">E-mail:</label>
                        <input type="email" id="cliente-email">
                    </div>
                </form>

                <!-- Se√ß√£o de Tipos Vinculados -->
                <div class="section" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #e9ecef;">
                    <h3>Tipos de Refei√ß√µes Vinculados</h3>
                    <div id="tipos-vinculados-lista">
                        <!-- Tipos vinculados aparecer√£o aqui -->
                    </div>
                    <button type="button" class="btn btn-primary" onclick="abrirModalTiposRefeicao()">
                        ‚ûï Adicionar Tipos de Refei√ß√£o
                    </button>
                </div>

                <div class="actions" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #e9ecef;">
                    <button class="btn btn-secondary" onclick="fecharModalCliente()">Cancelar</button>
                    <button class="btn btn-primary" onclick="salvarCliente()">Salvar</button>
                </div>
            </div>
        </div>

        <!-- Modal de Tipos de Refei√ß√£o para Cliente -->
        <div id="modal-tipos-refeicao" class="modal">
            <div class="modal-content">
                <div class="modal-header" style="background: linear-gradient(45deg, #667eea, #764ba2); color: white; padding: 20px; border-radius: 10px 10px 0 0; margin: -20px -20px 20px -20px;">
                    <h2 style="margin: 0; display: flex; align-items: center; gap: 10px;">
                        üçΩÔ∏è Selecionar Tipos de Refei√ß√£o
                        <span class="close" onclick="fecharModalTipos()" style="margin-left: auto; cursor: pointer; font-size: 28px; font-weight: bold;">&times;</span>
                    </h2>
                    <p style="margin: 5px 0 0 0; opacity: 0.9; font-size: 14px;">Escolha os tipos de refei√ß√µes para este cliente</p>
                </div>
                
                <div id="lista-tipos-modal">
                    <!-- Tipos de refei√ß√£o ser√£o carregados aqui -->
                </div>
                
                <div class="actions" style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #e9ecef;">
                    <button type="button" class="btn btn-secondary" onclick="fecharModalTipos()">
                        Cancelar
                    </button>
                </div>
            </div>
        </div>

        <!-- ===== MODAL DE INGREDIENTES ===== -->
        <div id="modalIngredientes" class="modal">
            <div class="modal-content">
                <div class="modal-header" style="background: linear-gradient(45deg, #667eea, #764ba2); color: white; padding: 20px; border-radius: 15px 15px 0 0; margin: -20px -20px 20px -20px;">
                    <h2>üõí Selecionar Ingredientes</h2>
                    <span class="close" onclick="fecharModalIngredientesFormulario()">&times;</span>
                </div>
                <div class="modal-body">
                    <div class="search-box">
                        <input type="text" id="buscarProduto" placeholder="üîç Buscar produtos..." 
                               onkeyup="filtrarProdutosFormulario()" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px;">
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <button class="btn btn-secondary btn-sm" onclick="selecionarTodosFormulario()">Selecionar Todos</button>
                        <button class="btn btn-secondary btn-sm" onclick="desmarcarTodosFormulario()">Desmarcar Todos</button>
                        <span style="margin-left: 20px; color: #666;">
                            <strong id="contadorSelecionados">0</strong> selecionados
                        </span>
                    </div>
                    
                    <div id="listaProdutos" style="max-height: 400px; overflow-y: auto;">
                        <!-- Produtos ser√£o carregados aqui -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="fecharModalIngredientesFormulario()">Cancelar</button>
                    <button class="btn btn-primary" onclick="transferirIngredientesFormulario()">
                        ‚û°Ô∏è Transferir Selecionados
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ===== SCRIPTS ===== -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/supabase-config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/core/utils.js"></script>
<script src="js/ui/toast.js"></script>
<script src="js/main-updated.js"></script>
    <script src="js/clientes-simplificado.js"></script>
    <script src="js/modulo-cardapios.js"></script>

    <script src="js/sistema-integracao.js"></script>

    <script>
        console.log('üöÄ Iniciando sistema simplificado...');

        // ===== TOAST NOTIFICATION =====
        function mostrarToast(mensagem, tipo = 'info', duracao = 3000) {
            // Remover toast existente
            const existingToast = document.querySelector('.toast-notification');
            if (existingToast) {
                existingToast.remove();
            }
            
            // Criar elemento toast
            const toast = document.createElement('div');
            toast.className = `toast-notification toast-${tipo}`;
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 10000;
                background: ${tipo === 'success' ? '#d4edda' : tipo === 'error' ? '#f8d7da' : tipo === 'warning' ? '#fff3cd' : '#d1ecf1'};
                color: ${tipo === 'success' ? '#155724' : tipo === 'error' ? '#721c24' : tipo === 'warning' ? '#856404' : '#0c5460'};
                padding: 12px 16px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                font-family: inherit;
                font-size: 14px;
                max-width: 400px;
                line-height: 1.4;
            `;
            
            const icones = {
                success: '‚úÖ',
                error: '‚ùå',
                warning: '‚ö†Ô∏è',
                info: '‚ÑπÔ∏è'
            };
            
            toast.innerHTML = `
                <div style="display: flex; align-items: flex-start; gap: 8px;">
                    <span>${icones[tipo] || icones.info}</span>
                    <div style="flex: 1;">${mensagem}</div>
                    <button onclick="this.parentElement.parentElement.remove()" style="background: none; border: none; font-size: 16px; cursor: pointer; margin-left: 10px; opacity: 0.7;">&times;</button>
                </div>
            `;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.remove();
                }
            }, duracao);
        }

        // ===== NAVEGA√á√ÉO ENTRE ABAS =====
        function showTab(tabName) {
            console.log('üìÇ Navegando para aba:', tabName);
            
            // Ocultar todas as abas
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            // Remover active de todos os bot√µes
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Mostrar aba selecionada
            const tabContent = document.getElementById(tabName);
            if (tabContent) {
                tabContent.classList.remove('hidden');
            }
            
            // Marcar bot√£o como ativo
            if (event && event.target) {
                event.target.classList.add('active');
            } else {
                const botaoTab = document.querySelector(`.tab[onclick*="${tabName}"]`);
                if (botaoTab) {
                    botaoTab.classList.add('active');
                }
            }
            
            // Inicializar m√≥dulos espec√≠ficos
            setTimeout(() => {
                switch(tabName) {
                    case 'produtos-novo':
                        console.log('üõí Inicializando produtos...');
                        if (typeof inicializarProdutosNovo === 'function') {
                            inicializarProdutosNovo();
                        }
                        break;
                        
                    case 'clientes':
                        console.log('üë• Inicializando clientes...');
                        if (typeof inicializarClientes === 'function') {
                            inicializarClientes().catch(error => {
                                console.error('‚ùå Erro ao inicializar clientes:', error);
                                mostrarToast('Erro ao inicializar clientes: ' + error.message, 'error');
                            });
                        }
                        break;
                        
                    case 'receitas':
                        console.log('üìã Inicializando receitas...');
                        if (typeof inicializarReceitas === 'function') {
                            inicializarReceitas();
                        }
                        break;
                        
                    default:
                        console.log('‚ÑπÔ∏è Aba sem inicializa√ß√£o espec√≠fica:', tabName);
                }
            }, 300);
        }

        // ===== SISTEMA DE PRODUTOS INTEGRADO =====
        let produtosNovoSistema = [];

        function aguardarSupabaseNovoSistema(callback, tentativas = 0) {
            if (window.supabase && window.supabase.auth) {
                callback();
            } else if (tentativas < 50) {
                setTimeout(() => aguardarSupabaseNovoSistema(callback, tentativas + 1), 100);
            } else {
                mostrarToast('Erro: Supabase n√£o carregou', 'error');
            }
        }

        function inicializarProdutosNovo() {
            aguardarSupabaseNovoSistema(async () => {
                try {
                    const { data: { user } } = await window.supabase.auth.getUser();
                    if (!user) {
                        window.location.href = 'login.html';
                        return;
                    }
                    
                    document.getElementById('status-supabase').textContent = 'Conectado';
                    document.getElementById('status-supabase').style.background = '#d4edda';
                    document.getElementById('status-supabase').style.color = '#155724';
                    document.getElementById('usuario-info').textContent = user.email;
                    
                    await carregarProdutosNovoSistema();
                    await gerarCodigoNovoSistema();
                    configurarEventosNovoSistema();
                    
                } catch (error) {
                    console.error('Erro:', error);
                    document.getElementById('ultimo-erro').textContent = error.message;
                }
            });
        }

        function configurarEventosNovoSistema() {
            const buscaInput = document.getElementById('busca-produtos');
            const filtroSelect = document.getElementById('filtro-grupo');
            
            if (buscaInput) {
                buscaInput.removeEventListener('input', filtrarNovoSistema);
                buscaInput.addEventListener('input', filtrarNovoSistema);
            }
            if (filtroSelect) {
                filtroSelect.removeEventListener('change', filtrarNovoSistema);
                filtroSelect.addEventListener('change', filtrarNovoSistema);
            }
        }

        async function gerarCodigoNovoSistema() {
            try {
                const { data: { user } } = await window.supabase.auth.getUser();
                const { data, error } = await window.supabase.rpc('get_next_produto_codigo', {
                    user_uuid: user.id
                });
                if (error) throw error;
                
                const input = document.getElementById('produto-codigo');
                if (input) {
                    input.value = data || 'PR000001';
                }
            } catch (error) {
                const input = document.getElementById('produto-codigo');
                if (input) {
                    input.value = 'PR000001';
                }
            }
        }

        async function carregarProdutosNovoSistema() {
            try {
                const { data: { user } } = await window.supabase.auth.getUser();
                const { data, error } = await window.supabase
                    .from('produtos')
                    .select('*')
                    .eq('user_id', user.id)
                    .order('codigo');

                if (error) throw error;
                produtosNovoSistema = data || [];
                renderizarNovoSistema();
                
            } catch (error) {
                console.error('Erro ao carregar:', error);
                document.getElementById('ultimo-erro').textContent = error.message;
            }
        }

        function renderizarNovoSistema() {
            const tbody = document.getElementById('produtos-tbody');
            const total = document.getElementById('total-produtos');
            
            if (!tbody || !total) return;
            
            tbody.innerHTML = '';
            total.textContent = produtosNovoSistema.length;

            if (produtosNovoSistema.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 20px;">Nenhum produto encontrado</td></tr>';
                return;
            }

            produtosNovoSistema.forEach(produto => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${produto.codigo}</td>
                    <td>${produto.descricao}</td>
                    <td>${produto.grupo}</td>
                    <td>${produto.unidade_medida}</td>
                    <td>${produto.peso_bruto || '-'}</td>
                    <td>${produto.peso_liquido || '-'}</td>
                    <td>R$ ${parseFloat(produto.preco || 0).toFixed(2)}</td>
                    <td>
                        <button onclick="editarNovoSistema('${produto.id}')" class="btn btn-primary btn-sm">Editar</button>
                        <button onclick="excluirNovoSistema('${produto.id}')" class="btn btn-danger btn-sm">Excluir</button>
                    </td>
                `;
            });
        }

        function filtrarNovoSistema() {
            const busca = document.getElementById('busca-produtos')?.value.toLowerCase() || '';
            const grupo = document.getElementById('filtro-grupo')?.value || '';
            
            let filtrados = produtosNovoSistema.filter(p => {
                const matchBusca = !busca || p.descricao.toLowerCase().includes(busca) || p.codigo.toLowerCase().includes(busca);
                const matchGrupo = !grupo || p.grupo === grupo;
                return matchBusca && matchGrupo;
            });
            
            const tbody = document.getElementById('produtos-tbody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            filtrados.forEach(produto => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${produto.codigo}</td>
                    <td>${produto.descricao}</td>
                    <td>${produto.grupo}</td>
                    <td>${produto.unidade_medida}</td>
                    <td>${produto.peso_bruto || '-'}</td>
                    <td>${produto.peso_liquido || '-'}</td>
                    <td>R$ ${parseFloat(produto.preco || 0).toFixed(2)}</td>
                    <td>
                        <button onclick="editarNovoSistema('${produto.id}')" class="btn btn-primary btn-sm">Editar</button>
                        <button onclick="excluirNovoSistema('${produto.id}')" class="btn btn-danger btn-sm">Excluir</button>
                    </td>
                `;
            });
        }

        async function abrirModalNovoProduto() {
            await gerarCodigoNovoSistema();
            document.getElementById('produto-id').value = '';
            document.getElementById('produto-descricao').value = '';
            document.getElementById('produto-grupo').value = 'Ingredientes';
            document.getElementById('produto-unidade').value = 'KG';
            document.getElementById('produto-peso-bruto').value = '';
            document.getElementById('produto-peso-liquido').value = '';
            document.getElementById('produto-preco').value = '';
            document.getElementById('modal-produto').style.display = 'block';
            
            setTimeout(() => {
                const descInput = document.getElementById('produto-descricao');
                if (descInput) descInput.focus();
            }, 100);
        }

        async function salvarProduto() {
            try {
                const { data: { user } } = await window.supabase.auth.getUser();
                
                const id = document.getElementById('produto-id').value;
                const dados = {
                    codigo: document.getElementById('produto-codigo').value.trim(),
                    descricao: document.getElementById('produto-descricao').value.trim(),
                    grupo: document.getElementById('produto-grupo').value,
                    unidade_medida: document.getElementById('produto-unidade').value,
                    peso_bruto: parseFloat(document.getElementById('produto-peso-bruto').value) || null,
                    peso_liquido: parseFloat(document.getElementById('produto-peso-liquido').value) || null,
                    preco: parseFloat(document.getElementById('produto-preco').value) || null,
                    user_id: user.id
                };

                if (!dados.descricao) {
                    mostrarToast('Informe a descri√ß√£o', 'warning');
                    document.getElementById('produto-descricao').focus();
                    return;
                }

                let result;
                if (id) {
                    result = await window.supabase.from('produtos').update(dados).eq('id', id).eq('user_id', user.id);
                } else {
                    result = await window.supabase.from('produtos').insert([dados]);
                }

                if (result.error) throw result.error;

                mostrarToast(id ? 'Produto atualizado com sucesso!' : 'Produto criado com sucesso!', 'success');
                fecharModalProduto();
                await carregarProdutosNovoSistema();

            } catch (error) {
                console.error('Erro ao salvar:', error);
                mostrarToast('Erro: ' + error.message, 'error');
                document.getElementById('ultimo-erro').textContent = error.message;
            }
        }

        function editarNovoSistema(id) {
            const produto = produtosNovoSistema.find(p => p.id === id);
            if (!produto) return;

            document.getElementById('produto-id').value = produto.id;
            document.getElementById('produto-codigo').value = produto.codigo;
            document.getElementById('produto-descricao').value = produto.descricao;
            document.getElementById('produto-grupo').value = produto.grupo;
            document.getElementById('produto-unidade').value = produto.unidade_medida;
            document.getElementById('produto-peso-bruto').value = produto.peso_bruto || '';
            document.getElementById('produto-peso-liquido').value = produto.peso_liquido || '';
            document.getElementById('produto-preco').value = produto.preco || '';
            document.getElementById('modal-produto').style.display = 'block';
            
            setTimeout(() => {
                const descInput = document.getElementById('produto-descricao');
                if (descInput) descInput.focus();
            }, 100);
        }

        async function excluirNovoSistema(id) {
            const produto = produtosNovoSistema.find(p => p.id === id);
            if (!produto || !confirm(`Excluir "${produto.descricao}"?`)) return;

            try {
                const { data: { user } } = await window.supabase.auth.getUser();
                const { error } = await window.supabase
                    .from('produtos')
                    .delete()
                    .eq('id', id)
                    .eq('user_id', user.id);
                    
                if (error) throw error;
                mostrarToast('Produto exclu√≠do com sucesso!', 'success');
                await carregarProdutosNovoSistema();
            } catch (error) {
                mostrarToast('Erro: ' + error.message, 'error');
                document.getElementById('ultimo-erro').textContent = error.message;
            }
        }

        function fecharModalProduto() {
            document.getElementById('modal-produto').style.display = 'none';
        }

        async function recarregarProdutos() {
            await carregarProdutosNovoSistema();
            mostrarToast('Produtos recarregados!', 'success');
        }

        // ===== FUN√á√ïES DE RECEITAS ORIGINAIS =====
        function abrirNovaReceita() {
            console.log('üîÑ abrirNovaReceita() original chamada');
            
            if (window.ModuloReceitas) {
                console.log('‚úÖ ModuloReceitas encontrado');
                console.log('üìä Estado:', window.ModuloReceitas.estado);
                console.log('üìã Fun√ß√µes:', Object.keys(window.ModuloReceitas));
                
                // Verificar se j√° foi inicializado
                if (window.ModuloReceitas.estado && window.ModuloReceitas.estado.inicializado) {
                    console.log('‚úÖ M√≥dulo j√° inicializado');
                    if (typeof window.ModuloReceitas.abrirModalNova === 'function') {
                        window.ModuloReceitas.abrirModalNova();
                    } else {
                        console.error('‚ùå Fun√ß√£o abrirModalNova n√£o existe');
                        mostrarToast('Fun√ß√£o abrirModalNova n√£o encontrada', 'error');
                    }
                } else {
                    console.log('üîÑ Inicializando m√≥dulo...');
                    if (typeof window.ModuloReceitas.inicializar === 'function') {
                        window.ModuloReceitas.inicializar().then(() => {
                            console.log('‚úÖ M√≥dulo inicializado');
                            setTimeout(() => {
                                if (window.ModuloReceitas.abrirModalNova) {
                                    window.ModuloReceitas.abrirModalNova();
                                } else {
                                    console.error('‚ùå abrirModalNova n√£o existe ap√≥s inicializa√ß√£o');
                                    mostrarToast('Erro: fun√ß√£o n√£o dispon√≠vel', 'error');
                                }
                            }, 500);
                        }).catch(error => {
                            console.error('‚ùå Erro ao inicializar:', error);
                            mostrarToast('Erro ao inicializar: ' + error.message, 'error');
                        });
                    } else {
                        console.error('‚ùå Fun√ß√£o inicializar n√£o existe');
                        mostrarToast('M√≥dulo com problema', 'error');
                    }
                }
            } else {
                console.error('‚ùå ModuloReceitas n√£o encontrado');
                mostrarToast('Sistema de receitas n√£o carregado', 'error');
            }
        }

        function listarReceitas() {
            console.log('üîÑ listarReceitas() chamada');
            
            if (window.ModuloReceitas) {
                console.log('‚úÖ ModuloReceitas encontrado');
                
                if (typeof window.ModuloReceitas.carregar === 'function') {
                    window.ModuloReceitas.carregar();
                } else if (typeof window.ModuloReceitas.inicializar === 'function') {
                    window.ModuloReceitas.inicializar().then(() => {
                        if (window.ModuloReceitas.carregar) {
                            window.ModuloReceitas.carregar();
                        } else {
                            mostrarToast('Fun√ß√£o carregar n√£o encontrada', 'error');
                        }
                    }).catch(error => {
                        console.error('Erro ao inicializar:', error);
                        mostrarToast('Erro ao inicializar: ' + error.message, 'error');
                    });
                } else {
                    mostrarToast('M√≥dulo com problema', 'error');
                }
            } else {
                console.error('‚ùå ModuloReceitas n√£o encontrado');
                mostrarToast('Sistema de receitas n√£o carregado', 'error');
            }
        }

        // ===== SISTEMA DE RECEITAS FORMUL√ÅRIO INTEGRADO - VERS√ÉO SEGURA =====
        let receitaFormulario = {
            id: null,
            codigo: '',
            descricao: '',
            rendimento: 0,
            unidadeRendimento: 'UN',
            pesoFinal: 0,
            modoPreparo: '',
            ingredientes: []
        };

        // ===== FUN√á√ÉO PARA ALTERNAR MODO DE PREPARO =====
        function toggleModoPreparo() {
            const content = document.getElementById('modoPreparoContent');
            const toggleText = document.getElementById('toggleText');
            
            if (content && toggleText) {
                if (content.classList.contains('hidden')) {
                    content.classList.remove('hidden');
                    toggleText.textContent = 'Ocultar';
                    mostrarToast('üìñ Modo de preparo exibido', 'info', 2000);
                } else {
                    content.classList.add('hidden');
                    toggleText.textContent = 'Exibir';
                    mostrarToast('üìñ Modo de preparo ocultado', 'info', 2000);
                }
            }
        }

        // ===== FUN√á√ÉO PARA MOSTRAR FORMUL√ÅRIO DE RECEITA =====
        function mostrarFormularioReceita() {
            const formulario = document.getElementById('formulario-receita');
            if (formulario) {
                formulario.style.display = 'block';
                gerarCodigoReceitaFormulario();
                // Focar no campo descri√ß√£o
                setTimeout(() => {
                    const descInput = document.getElementById('descricaoReceita');
                    if (descInput) descInput.focus();
                }, 100);
                mostrarToast('üìù Formul√°rio de receita aberto!', 'info');
            }
        }

        // ===== FUN√á√ÉO PARA GERAR C√ìDIGO DA RECEITA =====
        async function gerarCodigoReceitaFormulario() {
            try {
                const { data: { user } } = await window.supabase.auth.getUser();
                const { data, error } = await window.supabase.rpc('get_next_receita_codigo', {
                    user_uuid: user.id
                });
                
                if (error) throw error;
                
                const codigo = data || 'REC' + String(Math.floor(Math.random() * 1000)).padStart(3, '0');
                const input = document.getElementById('codigoReceita');
                if (input) {
                    input.value = codigo;
                    receitaFormulario.codigo = codigo;
                }
                
            } catch (error) {
                const codigo = 'REC' + String(Math.floor(Math.random() * 1000)).padStart(3, '0');
                const input = document.getElementById('codigoReceita');
                if (input) {
                    input.value = codigo;
                    receitaFormulario.codigo = codigo;
                }
            }
        }

        // ===== FUN√á√ÉO PARA CANCELAR EDI√á√ÉO =====
        function cancelarEdicaoReceita() {
            if (confirm('Tem certeza que deseja cancelar? Dados n√£o salvos ser√£o perdidos.')) {
                const formulario = document.getElementById('formulario-receita');
                if (formulario) {
                    formulario.style.display = 'none';
                }
                limparFormularioReceita();
                mostrarToast('‚ùå Edi√ß√£o cancelada', 'info');
            }
        }

        // ===== FUN√á√ÉO PARA LIMPAR FORMUL√ÅRIO =====
        function limparFormularioReceita() {
            const campos = [
                'descricaoReceita',
                'rendimento', 
                'pesoFinal',
                'modoPreparo'
            ];
            
            campos.forEach(campoId => {
                const campo = document.getElementById(campoId);
                if (campo) campo.value = '';
            });
            
            const unidadeSelect = document.getElementById('unidadeRendimento');
            if (unidadeSelect) unidadeSelect.value = 'UN';
            
            receitaFormulario.ingredientes = [];
            renderizarTabelaIngredientesFormulario();
            atualizarTotaisFormulario(0, 0, 0);
            
            receitaFormulario = {
                id: null,
                codigo: '',
                descricao: '',
                rendimento: 0,
                unidadeRendimento: 'UN',
                pesoFinal: 0,
                modoPreparo: '',
                ingredientes: []
            };
        }

        // ===== FUN√á√ÉO PARA ABRIR MODAL DE INGREDIENTES =====
        function abrirModalIngredientesFormulario() {
            const modal = document.getElementById('modalIngredientes');
            if (modal) {
                modal.style.display = 'block';
                carregarListaProdutosFormulario();
                atualizarContadorSelecionadosFormulario();
                mostrarToast('üõí Selecionando ingredientes...', 'info');
            }
        }

        // ===== FUN√á√ÉO PARA FECHAR MODAL DE INGREDIENTES =====
        function fecharModalIngredientesFormulario() {
            const modal = document.getElementById('modalIngredientes');
            if (modal) {
                modal.style.display = 'none';
            }
        }

        // ===== FUN√á√ÉO PARA CARREGAR LISTA DE PRODUTOS =====
        async function carregarListaProdutosFormulario() {
            const container = document.getElementById('listaProdutos');
            if (!container) return;
            
            container.innerHTML = '<p style="text-align: center; padding: 20px;">‚è≥ Carregando produtos...</p>';
            
            try {
                if (produtosNovoSistema && produtosNovoSistema.length > 0) {
                    renderizarListaProdutosFormulario(produtosNovoSistema);
                } else {
                    await carregarProdutosNovoSistema();
                    renderizarListaProdutosFormulario(produtosNovoSistema);
                }
            } catch (error) {
                container.innerHTML = '<p style="text-align: center; padding: 20px; color: #dc3545;">‚ùå Erro ao carregar produtos</p>';
                console.error('Erro ao carregar produtos:', error);
            }
        }

        // ===== FUN√á√ÉO PARA RENDERIZAR LISTA DE PRODUTOS =====
        function renderizarListaProdutosFormulario(produtos) {
            const container = document.getElementById('listaProdutos');
            if (!container) return;
            
            container.innerHTML = '';

            if (produtos.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">üì¶ Nenhum produto cadastrado</p>';
                return;
            }

            produtos.forEach((produto, index) => {
                const jaAdicionado = receitaFormulario.ingredientes.find(ing => ing.produtoId === produto.id);
                
                const div = document.createElement('div');
                div.className = 'produto-item';
                div.innerHTML = `
                    <input type="checkbox" id="produto-${produto.id}" value="${produto.id}" 
                           ${jaAdicionado ? 'checked disabled' : ''} 
                           onchange="atualizarContadorSelecionadosFormulario()">
                    <div class="produto-info">
                        <div class="produto-codigo">${produto.codigo}</div>
                        <div class="produto-nome">${produto.descricao}</div>
                    </div>
                    <div class="produto-preco">R$ ${parseFloat(produto.preco || 0).toFixed(2)}</div>
                    ${jaAdicionado ? '<span style="color: #28a745; font-weight: bold;">‚úì Adicionado</span>' : ''}
                `;
                container.appendChild(div);
            });
        }

        // ===== FUN√á√ÉO PARA FILTRAR PRODUTOS =====
        function filtrarProdutosFormulario() {
            const busca = document.getElementById('buscarProduto')?.value.toLowerCase() || '';
            const items = document.querySelectorAll('.produto-item');
            
            items.forEach(item => {
                const texto = item.textContent.toLowerCase();
                item.style.display = texto.includes(busca) ? 'flex' : 'none';
            });
        }

        // ===== FUN√á√ÉO PARA SELECIONAR TODOS =====
        function selecionarTodosFormulario() {
            const checkboxes = document.querySelectorAll('#listaProdutos input[type="checkbox"]:not(:disabled)');
            checkboxes.forEach(cb => cb.checked = true);
            atualizarContadorSelecionadosFormulario();
        }

        // ===== FUN√á√ÉO PARA DESMARCAR TODOS =====
        function desmarcarTodosFormulario() {
            const checkboxes = document.querySelectorAll('#listaProdutos input[type="checkbox"]:not(:disabled)');
            checkboxes.forEach(cb => cb.checked = false);
            atualizarContadorSelecionadosFormulario();
        }

        // ===== FUN√á√ÉO PARA ATUALIZAR CONTADOR =====
        function atualizarContadorSelecionadosFormulario() {
            const selecionados = document.querySelectorAll('#listaProdutos input[type="checkbox"]:checked:not(:disabled)').length;
            const contador = document.getElementById('contadorSelecionados');
            if (contador) {
                contador.textContent = selecionados;
            }
        }

        // ===== FUN√á√ÉO PARA TRANSFERIR INGREDIENTES =====
        function transferirIngredientesFormulario() {
            const checkboxes = document.querySelectorAll('#listaProdutos input[type="checkbox"]:checked:not(:disabled)');
            
            if (checkboxes.length === 0) {
                mostrarToast('‚ö†Ô∏è Selecione pelo menos um produto', 'warning');
                return;
            }

            let adicionados = 0;
            checkboxes.forEach(checkbox => {
                const produtoId = checkbox.value;
                const produto = produtosNovoSistema.find(p => p.id === produtoId);
                
                if (produto && !receitaFormulario.ingredientes.find(ing => ing.produtoId === produto.id)) {
                    const ingrediente = {
                        produtoId: produto.id,
                        codigo: produto.codigo,
                        nome: produto.descricao,
                        quantidade: 0,
                        unidadeMedida: produto.unidade_medida,
                        perdaPercent: 0,
                        ganhoPercent: 0,
                        precoUnitario: parseFloat(produto.preco || 0),
                        totalItem: 0
                    };
                    
                    receitaFormulario.ingredientes.push(ingrediente);
                    adicionados++;
                }
            });

            if (adicionados > 0) {
                renderizarTabelaIngredientesFormulario();
                calcularTotaisFormulario();
                mostrarToast(`‚úÖ ${adicionados} ingrediente(s) adicionado(s)`, 'success');
                fecharModalIngredientesFormulario();
            } else {
                mostrarToast('‚ÑπÔ∏è Todos os produtos selecionados j√° foram adicionados', 'info');
            }
        }

        // ===== FUN√á√ÉO PARA RENDERIZAR TABELA DE INGREDIENTES =====
        function renderizarTabelaIngredientesFormulario() {
            const tbody = document.getElementById('ingredientesTbody');
            if (!tbody) return;
            
            tbody.innerHTML = '';

            if (receitaFormulario.ingredientes.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="9" style="text-align: center; padding: 40px; color: #666;">
                            ü•ò Nenhum ingrediente adicionado<br>
                            <small>Clique em "Adicionar Ingredientes" para come√ßar</small>
                        </td>
                    </tr>
                `;
                return;
            }

            receitaFormulario.ingredientes.forEach((ingrediente, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${ingrediente.codigo}</td>
                    <td>${ingrediente.nome}</td>
                    <td>
                        <input type="number" class="inline-edit" value="${ingrediente.quantidade}" 
                               step="0.001" min="0" onchange="atualizarIngredienteFormulario(${index}, 'quantidade', this.value)">
                    </td>
                    <td>${ingrediente.unidadeMedida}</td>
                    <td>
                        <input type="number" class="inline-edit" value="${ingrediente.perdaPercent}" 
                               step="0.01" min="0" max="100" onchange="atualizarIngredienteFormulario(${index}, 'perdaPercent', this.value)">
                    </td>
                    <td>
                        <input type="number" class="inline-edit" value="${ingrediente.ganhoPercent}" 
                               step="0.01" min="0" max="100" onchange="atualizarIngredienteFormulario(${index}, 'ganhoPercent', this.value)">
                    </td>
                    <td>R$ ${ingrediente.precoUnitario.toFixed(2)}</td>
                    <td>
                        <strong style="color: #28a745;">
                            ${calcularTotalIngredienteFormulario(ingrediente).toFixed(3)} ${ingrediente.unidadeMedida}
                        </strong>
                    </td>
                    <td>
                        <button class="btn btn-danger btn-sm" onclick="removerIngredienteFormulario(${index})">
                            üóëÔ∏è Remover
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // ===== FUN√á√ÉO PARA ATUALIZAR INGREDIENTE =====
        function atualizarIngredienteFormulario(index, campo, valor) {
            const valorNumerico = parseFloat(valor) || 0;
            receitaFormulario.ingredientes[index][campo] = valorNumerico;
            
            const ingrediente = receitaFormulario.ingredientes[index];
            ingrediente.totalItem = calcularTotalIngredienteFormulario(ingrediente);
            
            renderizarTabelaIngredientesFormulario();
            setTimeout(calcularTotaisFormulario, 100);
        }

        // ===== FUN√á√ÉO PARA CALCULAR TOTAL DO INGREDIENTE =====
        function calcularTotalIngredienteFormulario(ingrediente) {
            const quantidade = parseFloat(ingrediente.quantidade) || 0;
            const perda = parseFloat(ingrediente.perdaPercent) || 0;
            const ganho = parseFloat(ingrediente.ganhoPercent) || 0;
            
            return quantidade * (1 - perda/100 + ganho/100);
        }

        // ===== FUN√á√ÉO PARA REMOVER INGREDIENTE =====
        function removerIngredienteFormulario(index) {
            if (confirm(`Deseja remover "${receitaFormulario.ingredientes[index].nome}"?`)) {
                receitaFormulario.ingredientes.splice(index, 1);
                renderizarTabelaIngredientesFormulario();
                calcularTotaisFormulario();
                mostrarToast('‚úÖ Ingrediente removido', 'success');
            }
        }

        // ===== FUN√á√ÉO PARA CALCULAR TOTAIS =====
        function calcularTotaisFormulario() {
            let valorTotal = 0;
            let pesoTotal = 0;

            receitaFormulario.ingredientes.forEach(ingrediente => {
                const quantidade = parseFloat(ingrediente.quantidade) || 0;
                const precoUnitario = parseFloat(ingrediente.precoUnitario) || 0;
                
                valorTotal += quantidade * precoUnitario;
                
                if (['KG', 'gr', 'mg'].includes(ingrediente.unidadeMedida)) {
                    let peso = calcularTotalIngredienteFormulario(ingrediente);
                    
                    if (ingrediente.unidadeMedida === 'gr') peso /= 1000;
                    if (ingrediente.unidadeMedida === 'mg') peso /= 1000000;
                    
                    pesoTotal += peso;
                }
            });

            const rendimento = parseFloat(document.getElementById('rendimento')?.value) || 1;
            const custoPorUnidade = rendimento > 0 ? valorTotal / rendimento : 0;

            atualizarTotaisFormulario(valorTotal, pesoTotal, custoPorUnidade);
            mostrarToast('üßÆ C√°lculos atualizados!', 'success', 1500);
        }

        // ===== FUN√á√ÉO PARA ATUALIZAR TOTAIS NA TELA =====
        function atualizarTotaisFormulario(valorTotal, pesoTotal, custoPorUnidade) {
            const campos = {
                'valorTotalReceita': `R$ ${valorTotal.toFixed(2)}`,
                'pesoTotalCalculado': `${pesoTotal.toFixed(3)} KG`,
                'custoPorUnidade': `R$ ${custoPorUnidade.toFixed(2)}`
            };
            
            Object.entries(campos).forEach(([id, valor]) => {
                const elemento = document.getElementById(id);
                if (elemento) elemento.textContent = valor;
            });
        }

        // ===== FUN√á√ÉO PARA SALVAR RECEITA =====
        async function salvarReceitaFormulario() {
            try {
                const descricao = document.getElementById('descricaoReceita')?.value.trim();
                if (!descricao) {
                    mostrarToast('‚ö†Ô∏è Digite a descri√ß√£o da receita', 'warning');
                    document.getElementById('descricaoReceita')?.focus();
                    return;
                }

                if (receitaFormulario.ingredientes.length === 0) {
                    mostrarToast('‚ö†Ô∏è Adicione pelo menos um ingrediente', 'warning');
                    return;
                }

                mostrarToast('üíæ Salvando receita...', 'info');

                const dados = {
                    codigo: document.getElementById('codigoReceita')?.value,
                    descricao: descricao,
                    rendimento: parseFloat(document.getElementById('rendimento')?.value) || 0,
                    unidade_rendimento: document.getElementById('unidadeRendimento')?.value,
                    peso_final: parseFloat(document.getElementById('pesoFinal')?.value) || 0,
                    modo_preparo: document.getElementById('modoPreparo')?.value,
                    preco_total: calcularValorTotalFormulario(),
                    user_id: (await window.supabase.auth.getUser()).data.user.id
                };

                console.log('Dados da receita para salvar:', dados);
                console.log('Ingredientes:', receitaFormulario.ingredientes);

                mostrarToast('‚úÖ Receita salva com sucesso!', 'success');
                
                setTimeout(() => {
                    if (confirm('Receita salva! Deseja criar uma nova receita?')) {
                        limparFormularioReceita();
                        gerarCodigoReceitaFormulario();
                    } else {
                        cancelarEdicaoReceita();
                    }
                }, 1500);

            } catch (error) {
                console.error('Erro ao salvar:', error);
                mostrarToast('‚ùå Erro ao salvar receita: ' + error.message, 'error');
            }
        }

        // ===== FUN√á√ÉO PARA CALCULAR VALOR TOTAL =====
        function calcularValorTotalFormulario() {
            return receitaFormulario.ingredientes.reduce((total, ingrediente) => {
                const quantidade = parseFloat(ingrediente.quantidade) || 0;
                const precoUnitario = parseFloat(ingrediente.precoUnitario) || 0;
                return total + (quantidade * precoUnitario);
            }, 0);
        }

        // ===== FUN√á√ÉO PERSONALIZADA PARA NOVA RECEITA =====
        function abrirNovaReceitaFormulario() {
            console.log('üîÑ Abrindo formul√°rio de nova receita...');
            mostrarFormularioReceita();
        }

        // ===== EXPORTAR FUN√á√ïES GLOBAIS =====
        window.mostrarToast = mostrarToast;
        window.showTab = showTab;
        window.abrirModalNovoProduto = abrirModalNovoProduto;
        window.salvarProduto = salvarProduto;
        window.editarNovoSistema = editarNovoSistema;
        window.excluirNovoSistema = excluirNovoSistema;
        window.fecharModalProduto = fecharModalProduto;
        window.recarregarProdutos = recarregarProdutos;
        window.inicializarProdutosNovo = inicializarProdutosNovo;
        window.abrirNovaReceita = abrirNovaReceita;
        window.listarReceitas = listarReceitas;

        // ===== EXPORTA√á√ïES ESPEC√çFICAS DO FORMUL√ÅRIO =====
        window.toggleModoPreparo = toggleModoPreparo;
        window.mostrarFormularioReceita = mostrarFormularioReceita;
        window.cancelarEdicaoReceita = cancelarEdicaoReceita;
        window.abrirNovaReceitaFormulario = abrirNovaReceitaFormulario;
        window.abrirModalIngredientesFormulario = abrirModalIngredientesFormulario;
        window.fecharModalIngredientesFormulario = fecharModalIngredientesFormulario;
        window.filtrarProdutosFormulario = filtrarProdutosFormulario;
        window.selecionarTodosFormulario = selecionarTodosFormulario;
        window.desmarcarTodosFormulario = desmarcarTodosFormulario;
        window.transferirIngredientesFormulario = transferirIngredientesFormulario;
        window.atualizarContadorSelecionadosFormulario = atualizarContadorSelecionadosFormulario;
        window.atualizarIngredienteFormulario = atualizarIngredienteFormulario;
        window.removerIngredienteFormulario = removerIngredienteFormulario;
        window.calcularTotaisFormulario = calcularTotaisFormulario;
        window.salvarReceitaFormulario = salvarReceitaFormulario;

        // ===== EVENTOS DE MODAL =====
        window.addEventListener('click', function(event) {
            const modais = ['modal-produto', 'modal-cliente', 'modal-tipos-refeicao', 'modalIngredientes'];
            modais.forEach(modalId => {
                const modal = document.getElementById(modalId);
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        });

        // ===== INICIALIZA√á√ÉO AUTOM√ÅTICA =====
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üìÑ DOM carregado - sistema simplificado pronto!');
            
            setTimeout(() => {
                console.log('üîç === VERIFICA√á√ÉO DO SISTEMA SIMPLIFICADO ===');
                console.log('üìã Fun√ß√µes principais dispon√≠veis:');
                console.log('  - showTab:', typeof window.showTab);
                console.log('  - mostrarToast:', typeof window.mostrarToast);
                console.log('  - inicializarClientes:', typeof window.inicializarClientes);
                console.log('  - recarregarClientes:', typeof window.recarregarClientes);
                console.log('  - abrirNovaReceita:', typeof window.abrirNovaReceita);
                console.log('  - listarReceitas:', typeof window.listarReceitas);
                console.log('  - ModuloReceitas:', !!window.ModuloReceitas);
                console.log('  - abrirNovaReceitaFormulario:', typeof window.abrirNovaReceitaFormulario);
                
                console.log('üéØ Elementos DOM encontrados:');
                console.log('  - Container principal:', !!document.querySelector('.container'));
                console.log('  - Tbody clientes:', !!document.getElementById('clientes-tbody'));
                console.log('  - Total clientes:', !!document.getElementById('total-clientes'));
                console.log('  - Bot√µes de tab:', document.querySelectorAll('.tab').length);
                console.log('  - Formul√°rio receita:', !!document.getElementById('formulario-receita'));
                console.log('  - Modal ingredientes:', !!document.getElementById('modalIngredientes'));
                
                console.log('‚úÖ Sistema simplificado carregado corretamente!');
                
                mostrarToast('‚úÖ Sistema carregado com sucesso!', 'success', 2000);
                
            }, 1000);
        });

        console.log('‚úÖ Sistema simplificado inicializado!');
    </script>

    function irParaReceitas() {
    window.location.href = 'pages/receitas.html';
}
</body>
</html>